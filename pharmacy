package pages;

import org.openqa.selenium.*;
import org.testng.Assert;
import coreUtilities.utils.CommonEvents;
import coreUtilities.utils.FileOperations;

import java.util.Map;

public class Pharmacy_Pages {

    WebDriver driver;
    CommonEvents events;
    Map<String, String> testData;

    By username = By.id("username");
    By password = By.id("password");
    By signInBtn = By.xpath("//button[text()='Sign In']");
    By pharmacyModule = By.xpath("//a[contains(text(),'Pharmacy')]");
    By orderTab = By.xpath("//a[contains(text(),'Order')]");
    By supplierTab = By.xpath("//a[contains(text(),'Supplier')]");

    public Pharmacy_Pages(WebDriver driver) {
        this.driver = driver;
        this.events = new CommonEvents(driver);
    }

    public void loadTestData(String path) {
        testData = FileOperations.readExcelData(path, "Pharmacy");
    }

    public void login(String url) {
        driver.get(url);
        events.enterText(username, "admin");
        events.enterText(password, "pass123");
        events.clickElement(signInBtn);
    }

    public void verifyHomePage() {
        Assert.assertEquals(driver.getTitle(), "DanpheHealth", "Title mismatch!");
        Assert.assertTrue(driver.getCurrentUrl().contains("/Home/Index#"), "URL mismatch!");
    }

    public void openPharmacyModule() {
        events.clickElement(pharmacyModule);
        Assert.assertTrue(driver.getCurrentUrl().contains("Pharmacy/Dashboard"), "Pharmacy module not opened!");
    }

    public void verifySubModules() {
        String[] subModules = {"Order", "Supplier", "Report", "Setting", "Store", "Supplier Ledger", "Substore Request/Dispatch"};
        for (String sub : subModules) {
            Assert.assertTrue(driver.getPageSource().contains(sub), sub + " not visible!");
        }
    }

    public void verifyOrderSection() {
        events.clickElement(orderTab);
        Assert.assertTrue(events.isElementDisplayed(By.xpath("//a[contains(text(),'Purchase Order')]")));
        Assert.assertTrue(events.isElementDisplayed(By.xpath("//a[contains(text(),'Goods Receipt')]")));
        Assert.assertTrue(events.isElementDisplayed(By.xpath("//input[@placeholder='Search']")));
    }

    public void verifySupplierNavigation() {
        events.clickElement(supplierTab);
        Assert.assertTrue(driver.getCurrentUrl().contains("Supplier"), "Supplier tab not opened!");
    }
}
